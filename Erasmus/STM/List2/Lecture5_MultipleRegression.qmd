---
title: Multiple Regression
---

# Reading Data

```{r}
data=(read.csv("List2/rent99.raw", sep=" "))
attach(data) # able to use location instead of data$location
head(data) # prints data header
data$location=as.factor(data$location) # treats location as a categorical variable (no linear correlation)
levels(data$location)=c("avg","good","top") # names the categorical variable's values
```

## basic description and scatter plot

```{r}
library(dplyr)
library(tableone)
CreateTableOne(factorVars=c("location", "bath", "kitchen", "cheating"), # makes a description table, which variables are we treating as categorical
               data=data%>%select(-district)) # syntactic "sugar" for select(data, -district) - we're taking all data without district variable
plot(data[,1:4]) # plots all rows and first 4 columns of data (the 12 scatterplots)
```

# Linear regression models

## multiple regression of rent onto area and yearc

```{r}
fit=lm(rent~area+I(yearc-1956),data=data) # I() - idiot function - treat arithmetics literally; fits a linear model where rent is linearly dependent on area and yearc
summary(fit)
```

## polynomial regression / quadratic effects

```{r}
fit.2=lm(rent~area+I(yearc-1956)+I((yearc-1956)^2),data=data)
summary(fit.2)
```
 
## plotting model estimates with basic plotting tools

```{r}
summary(data$area)

with(data,plot(rent~yearc)) # with() - syntactic sugar for plot(data$rent~data$yearc)

H=predict(fit.2, newdata= # uses fit.2 lm to predict rent for new data frame (90 x 5 new data rows)
            data.frame(expand.grid(yearc=1911:2000, area=c(20,51,65,81,160))))
for (i in 0:4){ # plots a line for each area (5 of them)
lines(1911:2000,H[i*90+1:90], lwd=3, col=i+2) # predicted rent vs yearc
} # lwd - line thickness, col - color
legend(1930,2000, legend=c("20m2","51m2","65m2","81m2","160m2"), fill=c(2:6))
```

# R^2 depends on range of X

## previous model
```{r}
fit=lm(rent~area+I(yearc-1956),data=data)
S=summary(fit)
S
```

## regression on subset with medium areas only

```{r}
fit.3=lm(rent~area+I(yearc-1956) ,data=data%>% filter(area>51, area<81)) # only picking data with medium area
S.3=summary(fit.3)
S.3

with(data,plot(area, rent))
abline(v=c(51,81), lwd=2, col=1) # two vertical lines
abline(c(97.42, 5.36), lwd=2, col=2) # linear function w/ intercept 97, slope 5
abline(c(146.56, 4.63), lwd=2, col=4)
```

We can observe that limiting data subset has a high impact on the model and how well it will fit.

## residual SE = sigma

```{r}
round(S$sigma,2)
round(S.3$sigma,2)
```

## R^2

```{r}
round(S$r.squared,2)
round(S.3$r.squared,2)
```

## estimated beta's

```{r}
round(coef(fit),2)
round(coef(fit.3),2)
```
